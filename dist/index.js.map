{"version":3,"file":"index.js","sources":["../webpack://typescript-work-item-state-update/webpack/runtime/compat","../webpack://typescript-work-item-state-update/./lib/main.js"],"sourcesContent":["\nif (typeof __webpack_require__ !== 'undefined') __webpack_require__.ab = new URL('.', import.meta.url).pathname.slice(import.meta.url.match(/^file:\\/\\/\\/\\w:/) ? 1 : 0, -1) + \"/\";","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core = __importStar(require(\"@actions/core\"));\nconst fetch = __importStar(require(\"node-fetch\"));\nconst github = __importStar(require(\"@actions/github\"));\nconst useGithub_1 = require(\"./useGithub\");\nconst useAzureBoards_1 = require(\"./useAzureBoards\");\nconst actionEnvModel_1 = require(\"./models/actionEnvModel\");\nconst version = '1.0.0';\nglobal.Headers = fetch.Headers;\nfunction run() {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n        try {\n            console.log('VERSION ' + version);\n            const vm = getValuesFromPayload(github.context.payload);\n            const { getPullRequest } = (0, useGithub_1.useGithub)();\n            const pullRequest = yield getPullRequest(vm);\n            console.log(console.log(`Pull Request object: ${pullRequest}`));\n            const { getWorkItemsFromText, getWorkItemIdFromBranchName, updateWorkItem } = (0, useAzureBoards_1.useAzureBoards)(vm);\n            if ((_b = (_a = process === null || process === void 0 ? void 0 : process.env) === null || _a === void 0 ? void 0 : _a.GITHUB_EVENT_NAME) === null || _b === void 0 ? void 0 : _b.includes('pull_request')) {\n                console.log('PR event');\n                if (typeof pullRequest.title != 'undefined' &&\n                    pullRequest.title.includes('bot')) {\n                    console.log('Bot branches are not to be processed');\n                    return;\n                }\n                try {\n                    let workItemIds = getWorkItemsFromText(pullRequest.title);\n                    if (workItemIds == null || workItemIds.length == 0) {\n                        workItemIds = getWorkItemsFromText(pullRequest.body);\n                    }\n                    if (workItemIds != null && workItemIds.length > 0) {\n                        workItemIds.forEach((workItemId) => __awaiter(this, void 0, void 0, function* () {\n                            console.log(`Update work item: ${workItemId}`);\n                            yield updateWorkItem(workItemId, pullRequest);\n                        }));\n                    }\n                    else {\n                        console.log(`No work items found to update.`);\n                    }\n                }\n                catch (err) {\n                    core.setFailed('Wrong PR title format. Make sure it includes AB#<ticket_number>.');\n                    core.setFailed(err.toString());\n                }\n            }\n            else {\n                console.log('Branch event');\n                if (vm.branchName.includes('master') || vm.branchName.includes('main')) {\n                    console.log('Automation will not handle commits pushed to master');\n                    return;\n                }\n                var workItemId = getWorkItemIdFromBranchName(vm.branchName);\n                if (workItemId != null) {\n                    yield updateWorkItem(workItemId, pullRequest);\n                }\n            }\n            console.log('Work item ' + workItemId + ' was updated successfully');\n        }\n        catch (err) {\n            core.setFailed(err.toString());\n        }\n    });\n}\nfunction getValuesFromPayload(payload) {\n    return new actionEnvModel_1.actionEnvModel(payload.action, process.env.gh_token, process.env.ado_token, process.env.ado_project, process.env.ado_organization, `https://dev.azure.com/${process.env.ado_organization}`, process.env.ghrepo_owner, process.env.ghrepo, process.env.pull_number, process.env.branch_name, process.env.closedstate, process.env.propenstate, process.env.inprogressstate);\n}\nrun();\n"],"mappings":";;AAAA;AACA;;;;ACDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;","sourceRoot":""}